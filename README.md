# Compress EPUB

一个简单的电子书压缩工具，专注于 EPUB 格式的电子书压缩。

## 开发规范

### 语言规范
- 面向用户的界面和提示信息统一使用英文
  - 包括：UI 文本、按钮文字、状态提示、错误提示等
  - 例如：'Start Compression', 'Compression Failed', 'Processing...'
- 面向开发者的内容使用中文
  - 包括：代码注释、控制台日志、开发文档等
  - 例如：'// 初始化压缩引擎', 'console.log('图片处理完成')'

## 功能特性

- 支持格式：EPUB 文件压缩
- 三种压缩级别：
  - 低压缩：最佳质量，文件体积较大
    * 图片质量：80%
    * 保持原始尺寸
    * 保持彩色图像
    * 优化 HTML/CSS
  - 中压缩：平衡质量和大小
    * 图片质量：50%
    * 图片缩小到原尺寸的75%
    * 保持彩色图像
    * 压缩 HTML/CSS
  - 高压缩：最小文件体积
    * 图片质量：30%
    * 图片缩小到原尺寸的50%
    * 转换为灰度图像
    * 最小化所有资源
- 拖拽上传功能
- 实时压缩进度显示
- 支持大文件（最大 50MB）

## 本地部署

### 环境要求

- Node.js >= 14

### 安装步骤

1. 克隆仓库
2. 安装依赖：`npm install`
3. 启动服务：`npm start`

## 技术栈

- Frontend: HTML, CSS, JavaScript
- Backend: Node.js, Express
- EPUB Processing: 
  - adm-zip：处理 EPUB 解压缩
  - sharp：图片处理和优化
  - clean-css：CSS 压缩
  - html-minifier：HTML 压缩

## 开发日志

### 2024-03-12
- 专注于 EPUB 格式支持
- 移除 PDF 相关功能
- 优化压缩策略

**优化方案详情：**

1. 压缩策略优化
   - 低压缩：
     * 图片质量：80%
     * 保持原始尺寸
     * 保持彩色图像
     * 适合注重质量的电子书
   - 中压缩：
     * 图片质量：50%
     * 图片缩小到原尺寸的75%
     * 保持彩色图像
     * 适合一般用途
   - 高压缩：
     * 图片质量：30%
     * 图片缩小到原尺寸的50%
     * 转换为灰度图像
     * 适合追求小体积

2. 技术实现重点
   - 使用 sharp 优化图片
   - 通过 clean-css 和 html-minifier 压缩代码
   - 保持代码结构简单清晰

3. 预期效果
   - 低压缩：文件减少 20-30%，保持最佳质量
   - 中压缩：文件减少 40-50%，平衡质量和大小
   - 高压缩：文件减少 60-70%，优先考虑文件大小

4. 优化原则
   - 不引入不必要的依赖库
   - 不修改现有前端界面
   - 专注于核心压缩功能
   - 保持代码简洁易维护

## 待优化项目

- [ ] 添加压缩预览功能
- [ ] 支持批量文件处理
- [ ] 添加文件完整性验证
- [ ] 优化压缩算法
- [ ] 添加更多自定义选项

## 技术文档

### 项目结构

```
compress-epub/
├── public/           # 静态文件
│   ├── css/         # 样式文件
│   ├── js/          # JavaScript 文件
│   └── index.html   # 主页面
├── server/          # 服务器代码
│   └── server.js    # Express 服务器
└── package.json     # 项目配置
```

### API 文档

#### 压缩接口

- 端点：`/compress`
- 方法：`POST`
- 参数：
  - `file`：EPUB 文件
  - `level`：压缩级别（low/medium/high）
- 返回：压缩后的 EPUB 文件

## 使用说明

1. 打开网页
2. 拖拽或选择 EPUB 文件
3. 选择压缩级别
4. 点击"开始压缩"
5. 等待压缩完成
6. 下载压缩后的文件

## 常见问题

### Q: 支持哪些 EPUB 版本？
A: 支持 EPUB 2.0 和 3.0 版本。

### Q: 压缩后的文件是否可以正常打开？
A: 是的，压缩过程会保持文件结构完整，确保可以正常打开和阅读。

### Q: 压缩需要多长时间？
A: 取决于文件大小和压缩级别，通常在30秒内完成。

## 贡献指南

欢迎提交 Issue 和 Pull Request。

## 开源协议

MIT License